"use strict";function sortPercent100_0(e,t){return t.value-e.value}function sortPercent0_100(e,t){return e.value-t.value}function sortAlphabetAtoZ(e,t){return e.name<t.name?-1:t.name<e.name?1:0}function sortAlphabetZtoA(e,t){return e.name<t.name?1:t.name<e.name?-1:0}function createListOfCompanies(e){listOfCompanies=e.list.length,$("#totalCompanies").text(listOfCompanies);for(var t=0;t<e.list.length;t++){var a="<div><a class='companyName' href='#'>"+(currentName=e.list[t].name)+"</a></div>";$(".holderCompanies").append(a)}}function createCompanyPartnersDiv(e,t){companyPartnersHolder.empty();for(var a=0;a<e.length;a++)if(e[a].name===t){switch(arrayOfPartners=e[a].partners,typeOfSort){case"sortPercent100_0":arrayOfPartners.sort(sortPercent100_0);break;case"sortPercent0_100":arrayOfPartners.sort(sortPercent0_100);break;case"nameAZ":arrayOfPartners.sort(sortAlphabetAtoZ);break;case"nameZA":arrayOfPartners.sort(sortAlphabetZtoA)}for(var r="",n=0;n<arrayOfPartners.length;n++)r="<div class='oneCompany'><div class='percentHolder'><p class='percentValue'>"+arrayOfPartners[n].value+"</p>%</div><div class='weakLines'></div><div class='mainName'>"+arrayOfPartners[n].name+"</div></div>",tempHTML+=r;mainCount="<div class='companiesMainCont'>"+tempHTML+"</div>",companyPartners="<div class='companyPartners "+e[a].name+"'><article class='sortCompany'><div class='textHolder'><h4>Company partners</h4><div><h3>Sort by: </h3><a href='#' class='nameSort'>Name</a><a href='#' class='percentageSort sortBySortPercent100_0'>Percentage</a><a href='#' class='closePartnersDiv'><img src='img/closeMenu.png' width='15' height='15' alt='closeMenu'></a></div></div>"+mainCount+"</article></div>"}companyPartnersHolder.append(companyPartners),tempHTML="",companyPartnersHolder.show(),$(".companyPartners").show()}function refreshDivCompanyPartners(e,t){for(var a=0;a<t.length;a++)e[a].getElementsByClassName("mainName")[0].innerText=t[a].name,e[a].getElementsByClassName("percentValue")[0].innerText=t[a].value}function createArrayInsideOneCompany(e){tempArray=[];for(var t=0;t<e.length;t++)tempArray[t]={name:e[t].getElementsByClassName("mainName")[0].innerText,value:e[t].getElementsByClassName("percentValue")[0].innerText};return tempArray}function createCircleChart(e){for(var t=0;t<e.length;t++)tempCountry=e[t].location.name,locationObj[tempCountry]=0;for(var a=0;a<e.length;a++)locationObj[e[a].location.name]+=1;for(var r in locationObj)locationObj[r]=locationObj[r]/e.length*100;drawCircle(locationObj)}function drawCircle(e){google.charts.load("current",{packages:["corechart"]}),google.charts.setOnLoadCallback(function(){var e=google.visualization.arrayToDataTable([["Country","quantity"],["Poland",t[0]],["Ukraine",t[1]],["United States",t[2]],["Norway",t[3]],["Sweden",t[4]],["Germany",t[5]]]),a={title:""},r=new google.visualization.PieChart(document.getElementById("piechart"));google.visualization.events.addListener(r,"select",function(){var t=r.getSelection()[0];t&&openCountryList(e.hc[t.row][0].Cf)}),r.draw(e,a)});var t=[];for(var a in e)e.hasOwnProperty(a)&&t.push(e[a])}function openCountryList(e){createCountriesList(createCountriesObject(),e);var t=$(".closeHolder");$(".infoAboutCountry").show(),t.show(),t.css("display","inline-block")}function createCountriesObject(){for(var e={},t=[],a=0;a<dataList.length;a++)e[dataList[a].location.name]=[];for(var r in e)if(e.hasOwnProperty(r)){for(var n=0;n<dataList.length;n++)r===dataList[n].location.name&&t.push(dataList[n]);e[r]=t,t=[]}return e}function createCountriesList(e,t){holderCountriesCompany.html("");for(var a in e)if(e.hasOwnProperty(a)&&a==t)for(var r=0;r<e[a].length;r++){var n="<div><a class='companyName' href='#'>"+(currentName=e[a][r].name)+"</a></div>";$(".countryName").text(a),holderCountriesCompany.append(n)}}function createNews(e){var t,a,r,n="",s="",o="",i="",c="";a=e[0].img.match(/\d{3}/)[0],r=e[0].img.match(/x\d{3}/)[0].substring(1),t="<div class='articleWrapper slider sliderNow'><div class='newsFirstRowPadding'><div class='articleWrapper'><div class='newsImg'><div><img src='"+e[0].img+"' alt='News Image' width='"+a+"' height='"+r+"'></div></div><div class='newsDescription'><h5><a href='//"+e[0].link+"'>News Title</a></h5><p class='newsText'>"+checkDescriptionLength(e[0].description)+"</p></div></div><div class='newsInfo'><p><span class='newsHeadline'>Autor: </span>"+e[0].author+"</p><p><span class='newsHeadline'>Public: </span>"+dateConvert(e[0].date)+"</p></div></div></div>",newsPadding.append(t);for(var l=1;l<e.length;l++)n=e[l].author,s=dateConvert(e[l].date),o=e[l].link,i=checkDescriptionLength(i=e[l].description),a=(c=e[l].img).match(/\d{3}/)[0],t="<div class='articleWrapper slider'><div class='newsFirstRowPadding'><div class='articleWrapper'><div class='newsImg'><div><img src='"+c+"' alt='News Image' height='"+(r=c.match(/x\d{3}/)[0].substring(1))+"' width='"+a+"'></div></div><div class='newsDescription'><h5><a href='//"+o+"'>News Title</a></h5><p class='newsText'>"+i+"</p></div></div><div class='newsInfo'><p><span class='newsHeadline'>Autor: </span>"+n+"</p><p><span class='newsHeadline'>Public: </span>"+s+"</p></div></div></div>",newsPadding.append(t)}function checkDescriptionLength(e){var t,a=e;return window.innerWidth>=320&&window.innerWidth<=500?t=60:window.innerWidth>=501&&window.innerWidth<=767?t=150:window.innerWidth>=768&&window.innerWidth<=1023?t=120:window.innerWidth>=1024&&(t=160),e.length>t&&(a=e.slice(0,t-3)+"..."),a}function dateConvert(e){var t=new Date(1e3*e),a=t.getDate();a<10&&(a="0"+a);var r=t.getMonth()+1;return r<10&&(r="0"+r),a+"."+r+"."+t.getFullYear()}var listOfCompanies=0,dataList={},listOfNews={},mainCount="",tempHTML="",currentName="",tempParent={},currentParent={},typeOfSort="sortPercent100_0",arrayForSort=[],tempArray=[],companyPartners="",arrayOfPartners=[],companyPartnersHolder=$(".companyPartnersHolder"),body=$("body"),holderCountriesCompany=$(".holderCountriesCompany"),newsPadding=$(".newsPadding"),locationObj={},tempCountry="";$(document).ready(function(){try{$.ajax({type:"POST",url:"http://codeit.pro/frontTestTask/company/getList",response:"xml",success:function(e){dataList=e.list,createListOfCompanies(e),createCircleChart(dataList),body.on("click",".companyName",function(t){t.preventDefault(),$(".companyName").css("background","none"),$(this).css("background","#a9a9a9");var a=this.innerText;$("."+a).show(),createCompanyPartnersDiv(e.list,a)}),body.on("click",".nameSort",function(e){e.preventDefault(),tempParent=$(this).closest(".sortCompany"),currentParent=document.getElementsByClassName("oneCompany"),arrayForSort=createArrayInsideOneCompany(currentParent),$(this).hasClass("sortByNameA-Z")?(arrayForSort.sort(sortAlphabetZtoA),typeOfSort="nameZA"):(arrayForSort.sort(sortAlphabetAtoZ),typeOfSort="nameAZ"),refreshDivCompanyPartners(currentParent,arrayForSort),$(this).toggleClass("sortByNameA-Z")}),body.on("click",".percentageSort",function(e){e.preventDefault(),tempParent=$(this).closest(".sortCompany"),currentParent=document.getElementsByClassName("oneCompany"),arrayForSort=createArrayInsideOneCompany(currentParent),$(this).hasClass("sortBySortPercent100_0")?(arrayForSort.sort(sortPercent0_100),typeOfSort="sortPercent0_100"):(arrayForSort.sort(sortPercent100_0),typeOfSort="sortPercent100_0"),refreshDivCompanyPartners(currentParent,arrayForSort),$(this).toggleClass("sortBySortPercent100_0")}),body.on("click",".closeHref",function(e){e.preventDefault(),$(".closeHolder").hide(),$(".infoAboutCountry").hide()}),body.on("click",".closePartnersDiv",function(e){e.preventDefault(),companyPartnersHolder.html(""),companyPartnersHolder.hide(""),$(".companyName").css("background","none")}),$(window).on("resize",function(){createCircleChart(dataList)})}})}catch(e){alert(e.message)}try{$.ajax({type:"POST",url:"http://codeit.pro/frontTestTask/news/getList",response:"xml",success:function(e){createNews((listOfNews=e).list)}})}catch(e){alert(e.message)}}),$(window).on("throttledresize",function(){var e={width:"100%",height:"100%"},t=google.visualization.arrayToDataTable([]);drawChart(t,e)}),document.getElementsByClassName||(document.getElementsByClassName=function(e){for(var t,a=[],r=0,n=(t=document.all?document.all:document.getElementsByTagName("*")).length;r<n;r++)t[r].className==e&&(a[a.length]=t[r]);return a});